<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Events • campsis</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Events">
<meta property="og:description" content="campsis">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">campsis</a>
        <span class="version label label-warning" data-toggle="tooltip" data-placement="bottom" title="">0.8.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/campsis.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/v01_dataset.html">Create your dataset</a>
    </li>
    <li>
      <a href="../articles/v02_uncertainties.html">Uncertainty levels</a>
    </li>
    <li>
      <a href="../articles/v03_covariates.html">Covariates</a>
    </li>
    <li>
      <a href="../articles/v04_bioavailability.html">Bioavailability</a>
    </li>
    <li>
      <a href="../articles/v05_lag_time.html">Lag time</a>
    </li>
    <li>
      <a href="../articles/v06_infusions.html">Infusions</a>
    </li>
    <li>
      <a href="../articles/v07_iov.html">Inter-occasion variability</a>
    </li>
    <li>
      <a href="../articles/v08_initial_conditions.html">Initial conditions</a>
    </li>
    <li>
      <a href="../articles/v09_dose_adaptation.html">Simple dose adaptations</a>
    </li>
    <li>
      <a href="../articles/v10_replicate_study.html">Replicate your study</a>
    </li>
    <li>
      <a href="../articles/v11_scenarios.html">Scenarios</a>
    </li>
    <li>
      <a href="../articles/v12_events.html">Events</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Calvagone/campsis/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="v12_events_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Events</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Calvagone/campsis/blob/master/vignettes/v12_events.Rmd"><code>vignettes/v12_events.Rmd</code></a></small>
      <div class="hidden name"><code>v12_events.Rmd</code></div>

    </div>

    
    
<p>This vignette shows how interruption events can be implemented.</p>
<div id="body-weight-as-a-time-varying-covariate" class="section level3">
<h3 class="hasAnchor">
<a href="#body-weight-as-a-time-varying-covariate" class="anchor"></a>Body weight as a time varying covariate</h3>
<p>Assume <code>BW</code> vary over time. Events allow you to implement such time-varying covariates without modifying the dataset. In the example below, <code>BW</code> progressively decreases over time.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">model_library</span><span class="op">$</span><span class="va">advan2_trans2</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span><span class="op">(</span><span class="fu">Equation</span><span class="op">(</span><span class="st">"CL"</span>, <span class="st">"THETA_CL*exp(ETA_CL)*pow(BW/70, 0.75)"</span><span class="op">)</span><span class="op">)</span>

<span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Dataset.html">Dataset</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">add</span><span class="op">(</span><span class="fu"><a href="../reference/Bolus.html">Bolus</a></span><span class="op">(</span>time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">24</span><span class="op">)</span>, amount<span class="op">=</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">add</span><span class="op">(</span><span class="fu"><a href="../reference/Observations.html">Observations</a></span><span class="op">(</span>times<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">48</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">add</span><span class="op">(</span><span class="fu"><a href="../reference/TimeVaryingCovariate.html">TimeVaryingCovariate</a></span><span class="op">(</span><span class="st">"BW"</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span>

<span class="va">events</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Events.html">Events</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">event1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"New weight of 60"</span>, times<span class="op">=</span><span class="fl">15</span>, fun<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">inits</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">inits</span><span class="op">$</span><span class="va">BW</span> <span class="op">&lt;-</span> <span class="fl">60</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">inits</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="va">event2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"New weight of 30"</span>, times<span class="op">=</span><span class="fl">30</span>, fun<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">inits</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">inits</span><span class="op">$</span><span class="va">BW</span> <span class="op">&lt;-</span> <span class="fl">30</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">inits</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="va">events</span> <span class="op">&lt;-</span> <span class="va">events</span> <span class="op">%&gt;%</span> <span class="fu">add</span><span class="op">(</span><span class="va">event1</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">add</span><span class="op">(</span><span class="va">event2</span><span class="op">)</span>

<span class="va">results</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/simulate.html">simulate</a></span><span class="op">(</span><span class="va">dataset</span>, dest<span class="op">=</span><span class="st">"RxODE"</span>, events<span class="op">=</span><span class="va">events</span>, seed<span class="op">=</span><span class="fl">1</span>, outvars<span class="op">=</span><span class="st">"BW"</span><span class="op">)</span>

<span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="fu"><a href="../reference/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">results</span>, <span class="st">"CP"</span><span class="op">)</span>, <span class="fu"><a href="../reference/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">results</span>, <span class="st">"BW"</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="v12_events_files/figure-html/event_bw_as_time_varying_covariate-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div id="dose-adaptation-based-on-ctrough-value" class="section level3">
<h3 class="hasAnchor">
<a href="#dose-adaptation-based-on-ctrough-value" class="anchor"></a>Dose adaptation based on Ctrough value</h3>
<p>For this first example of dose adaptation, we’re going to adapt the dose based on <code>Ctrough</code>. Say we’d like <code>Ctrough</code> not to exceed an arbitrary safety limit of 5 mg/L. The rule could be as follows: if <code>Ctrough</code> is greater than 5, multiply the last dose by 0.75, otherwise continue with the same dose. Let’s illustrate this simple rule using events. We will use the first compartment model with absorption from the model library for this purpose.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">model_library</span><span class="op">$</span><span class="va">advan2_trans2</span>

<span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Dataset.html">Dataset</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">add</span><span class="op">(</span><span class="fu"><a href="../reference/Observations.html">Observations</a></span><span class="op">(</span>times<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">168</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">add</span><span class="op">(</span><span class="fu"><a href="../reference/TimeVaryingCovariate.html">TimeVaryingCovariate</a></span><span class="op">(</span><span class="st">"DOSE"</span>, <span class="fl">1500</span><span class="op">)</span><span class="op">)</span>

<span class="va">events</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Events.html">Events</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">event1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Event.html">Event</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Dose adaptation"</span>, times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">144</span>, by<span class="op">=</span><span class="fl">24</span><span class="op">)</span>, fun<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">inits</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">inits</span><span class="op">$</span><span class="va">DOSE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">inits</span><span class="op">$</span><span class="va">CP</span> <span class="op">&gt;</span> <span class="fl">5</span>, <span class="va">inits</span><span class="op">$</span><span class="va">DOSE</span><span class="op">*</span><span class="fl">0.75</span>, <span class="va">inits</span><span class="op">$</span><span class="va">DOSE</span><span class="op">)</span>
  <span class="va">inits</span><span class="op">$</span><span class="va">A_DEPOT</span> <span class="op">&lt;-</span> <span class="va">inits</span><span class="op">$</span><span class="va">A_DEPOT</span> <span class="op">+</span> <span class="va">inits</span><span class="op">$</span><span class="va">DOSE</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">inits</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="va">events</span> <span class="op">&lt;-</span> <span class="va">events</span> <span class="op">%&gt;%</span> <span class="fu">add</span><span class="op">(</span><span class="va">event1</span><span class="op">)</span>

<span class="va">results</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/simulate.html">simulate</a></span><span class="op">(</span><span class="va">dataset</span>, dest<span class="op">=</span><span class="st">"RxODE"</span>, events<span class="op">=</span><span class="va">events</span>, seed<span class="op">=</span><span class="fl">1</span>, outvars<span class="op">=</span><span class="st">"DOSE"</span><span class="op">)</span>

<span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="fu"><a href="../reference/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">results</span>, <span class="st">"CP"</span><span class="op">)</span>, <span class="fu"><a href="../reference/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">results</span>, <span class="st">"DOSE"</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="v12_events_files/figure-html/event_dose_adaptation_ctrough-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nicolas Luyckx.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
